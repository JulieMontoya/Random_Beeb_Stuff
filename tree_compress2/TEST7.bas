   10MODE7
   20HIMEM=&5800
   30*L.STRM4
   40*L.BITS
   50*K.1P.~USR&7800,~FNpeek(&70),~?&73|M
   60*K.2CALL&7803|M
  100stream_ptr=&70
  110stream_bit=&72
  120tree_pos=&73
  130reset_tree_pos=&7803
  140disp_char=&7806
  150select_msg=&7809
  200PROCpoke(stream_ptr,&7000)
  210?stream_bit=0
  220?tree_pos=0
 9990END
11000PROCpoke(stream_ptr,&7000)
11010?stream_bit=0
11020REPEAT
11030?dest=0:?dest_bit=0
11040REPEAT
11050U%=USR&7800
11060UNTILU%AND&1000000
11070VDUU%AND255
11080UNTIL(U%AND255)<32
11140END
12999END
13000DEFFNpeek(P%)
13010Q%=!P%AND&FFFF:IFQ%>32767Q%=Q%OR&FFFF0000
13020=Q%
13030DEFPROCpoke(P%,Q%)
13040!P%=!P%AND&FFFF0000ORQ%AND&FFFF
13050ENDPROC
